@using TechNova.Models.Core
@model Order

@{
    ViewData["Title"] = "Chi tiết đơn hàng";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<h2>📝 Chi tiết đơn hàng #@Model.OrderId</h2>

<p><strong>Khách hàng:</strong> @Model.User?.Username (@Model.User?.Email)</p>
<p><strong>Ngày đặt:</strong> @Model.CreatedAt.ToString("dd/MM/yyyy HH:mm")</p>
<p><strong>Trạng thái đơn hàng:</strong> @Model.Status</p>
<p><strong>Phương thức thanh toán:</strong> @Model.Payment?.Method</p>
<p><strong>Trạng thái thanh toán:</strong> @Model.Payment?.Status</p>
<hr />

<h4>📦 Thông tin giao hàng</h4>
@if (Model.Address != null)
{
    <p><strong>Người nhận:</strong> @Model.Address.FullName</p>
    <p><strong>Điện thoại:</strong> @Model.Address.Phone</p>
    <p><strong>Địa chỉ:</strong> @Model.Address.Street, @Model.Address.Ward, @Model.Address.District, @Model.Address.City</p>
}
else
{
    <p class="text-danger">Không tìm thấy địa chỉ giao hàng.</p>
}


<hr />

<h4 class="mt-4">🛍️ Sản phẩm</h4>
<table class="table table-striped">
    <thead>
        <tr>
            <th>Ảnh</th>
            <th>Sản phẩm</th>
            <th>Số lượng</th>
            <th>Đơn giá</th>
            <th>Tổng</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model.OrderItems)
        {
            <tr>
                <td><img src="@item.Product?.MainImageUrl" alt="@item.Product?.Name" width="60" /></td>
                <td>@item.Product?.Name</td>
                <td>@item.Quantity</td>
                <td>@item.Price.ToString("N0")₫</td>
                <td>@((item.Price * item.Quantity).ToString("N0"))₫</td>
            </tr>
        }
    </tbody>
</table>

<h4 class="text-end text-danger">Tổng cộng: @Model.TotalAmount.ToString("N0")₫</h4>

<form asp-action="UpdateStatus" method="post" class="mt-4">
    <input type="hidden" name="orderId" value="@Model.OrderId" />
    <div class="form-group">
        <label for="status">Cập nhật trạng thái:</label>
        <select name="status" class="form-control w-25 d-inline-block">
            <option selected>@Model.Status</option>
            <option value="Đang xử lý">Đang xử lý</option>
            <option value="Đang giao hàng">Đang giao hàng</option>
            <option value="Hoàn tất">Hoàn tất</option>
            <option value="Đã huỷ">Đã huỷ</option>
        </select>
        <button type="submit" class="btn btn-success ms-2">Cập nhật</button>
    </div>
</form>

<a asp-action="Index" class="btn btn-secondary mt-3">← Quay lại</a>
