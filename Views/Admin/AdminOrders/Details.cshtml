@using TechNova.Models.Core
@model Order

@{
    var currentStatus = Model.Status;
    ViewData["Title"] = "Chi tiết đơn hàng";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<h2>📝 Chi tiết đơn hàng #@Model.OrderId</h2>

<p><strong>Khách hàng:</strong> @Model.User?.Username (@Model.User?.Email)</p>
<p><strong>Ngày đặt:</strong> @Model.CreatedAt.ToString("dd/MM/yyyy HH:mm")</p>
<p><strong>Trạng thái đơn hàng:</strong> @Model.Status</p>
<p><strong>Phương thức thanh toán:</strong> @Model.Payment?.Method</p>
<p><strong>Trạng thái thanh toán:</strong> @Model.Payment?.Status</p>
<hr />

<h4>📦 Thông tin giao hàng</h4>
@if (Model.Address != null)
{
    <p><strong>Người nhận:</strong> @Model.Address.FullName</p>
    <p><strong>Điện thoại:</strong> @Model.Address.Phone</p>
    <p><strong>Địa chỉ:</strong> @Model.Address.Street, @Model.Address.Ward, @Model.Address.District, @Model.Address.City</p>
}
else
{
    <p class="text-danger">Không tìm thấy địa chỉ giao hàng.</p>
}


<hr />

<h4 class="mt-4">🛍️ Sản phẩm</h4>
<table class="table table-striped">
    <thead>
        <tr>
            <th>Ảnh</th>
            <th>Sản phẩm</th>
            <th>Số lượng</th>
            <th>Đơn giá</th>
            <th>Tổng</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model.OrderItems)
        {
            <tr>
                <td><img src="@item.Product?.MainImageUrl" alt="@item.Product?.Name" width="60" /></td>
                <td>@item.Product?.Name</td>
                <td>@item.Quantity</td>
                <td>@item.Price.ToString("N0")₫</td>
                <td>@((item.Price * item.Quantity).ToString("N0"))₫</td>
            </tr>
        }
    </tbody>
</table>

<h4 class="text-end text-danger">Tổng cộng: @Model.TotalAmount.ToString("N0")₫</h4>

@{
    var nextStatus = currentStatus switch
    {
        "Chờ xác nhận" => "Đang xử lý",
        "Đang xử lý" => "Đang giao hàng",
        "Đang giao hàng" => "Hoàn tất",
        _ => null
    };
}

@if (nextStatus != null)
{
    <form asp-action="UpdateStatus" method="post" class="mt-4">
        <input type="hidden" name="orderId" value="@Model.OrderId" />
        <input type="hidden" name="status" value="@nextStatus" />
        <div class="form-group">
            <label>Trạng thái hiện tại: <strong>@currentStatus</strong></label><br />
            <button type="submit" class="btn btn-warning mt-2">
                Cập nhật sang: <strong>@nextStatus</strong>
            </button>
        </div>
    </form>
}
else
{
    <p><span class="badge bg-success">✅ Đơn hàng đã hoàn tất hoặc không thể cập nhật thêm.</span></p>
}


<a asp-action="Index" class="btn btn-secondary mt-3">← Quay lại</a>
